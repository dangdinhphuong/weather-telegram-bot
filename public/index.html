<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8" />
    <title>Weather Widget - HÃ  Ná»™i</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/style.css" />
</head>
<body>
<div id="app">Äang táº£i dá»¯ liá»‡u...</div>

<script>
async function loadWeather() {
    const res = await fetch("/api/latest");
    const json = await res.json();

    const c = json.data.current;

    const icons = {
        sunny: "â˜€ï¸",
        mostly_sunny: "ğŸŒ¤",
        partly_sunny: "â›…",
        clear: "ğŸŒ™",
        mostly_clear: "ğŸŒ™",
        fog: "ğŸŒ«",
        cloudy: "â˜ï¸",
        rain: "ğŸŒ§",
        snow: "â„ï¸"
    };

    let html = `
        <div class="widget">

            <h2>${json.city}</h2>

            <div class="big-temp">${c.temperature}Â°C</div>
            <div class="summary">${icons[c.weather] || "ğŸŒ¤"} ${c.summary}</div>

            <div class="small">ğŸ’¨ GiÃ³: ${c.wind.speed} m/s â€” ${c.wind.dir}</div>
            <div class="small">â˜ï¸ MÃ¢y: ${c.cloud_cover}%</div>
            <div class="small">â˜” MÆ°a: ${c.precipitation.total}mm (${c.precipitation.type})</div>

            <div class="time">${json.time}</div>

            <h3>Trong 5 giá» tiáº¿p theo</h3>
            <div class="history">
    `;

    json.data.hourly.data.slice(0, 5).forEach(h => {
        const icon = icons[h.weather] || "ğŸŒ¤";
        const time = h.date.slice(11, 16);

        html += `
            <div class="item">
                <div><b>${time}</b></div>
                <div>${icon} ${h.summary} â€” ${h.temperature}Â°C</div>
            </div>
        `;
    });
        html += `
            <div id="btnUpdate" class="btn item">
                Cáº­p nháº­t ngay
            </div>
        `;
    html += `</div></div>`;
    document.getElementById("app").innerHTML = html;
}

loadWeather();
setInterval(loadWeather, 5000);

// Button cáº­p nháº­t
document.addEventListener("click", async e => {
    if (e.target.id === "btnUpdate") {
        e.target.innerText = "â³ Äang cáº­p nháº­t...";
        await fetch("/api/update");
        await loadWeather();
        e.target.innerText = "ğŸ”„ Cáº­p nháº­t ngay";
    }
});
</script>

</body>
</html>
